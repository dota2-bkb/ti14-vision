<!DOCTYPE html>
<html>
<head>
    <title>Debug CSV Parsing</title>
</head>
<body>
    <h1>CSV Date Parsing Debug</h1>
    <input type="file" id="csvFile" accept=".csv">
    <div id="output"></div>

    <script>
        document.getElementById('csvFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                debugCSVParsing(csv);
            };
            reader.readAsText(file);
        });

        function debugCSVParsing(csv) {
            console.log('Raw CSV length:', csv.length);
            console.log('Raw CSV (first 200 chars):', csv.substring(0, 200));
            
            // Test different line splitting methods
            const lines1 = csv.trim().split('\n');
            const lines2 = csv.trim().split(/\r?\n/);
            
            console.log('Lines with \\n split:', lines1.length);
            console.log('Lines with /\\r?\\n/ split:', lines2.length);
            
            // Check the last few lines for debugging
            for (let i = Math.max(0, lines2.length - 3); i < lines2.length; i++) {
                const line = lines2[i];
                console.log(`Line ${i}:`, line);
                console.log(`Line ${i} length:`, line.length);
                console.log(`Line ${i} ends with \\r:`, line.endsWith('\r'));
                
                if (line.trim()) {
                    const parts = parseCSVLine(line);
                    console.log(`Line ${i} parts:`, parts.length);
                    if (parts.length >= 6) {
                        const gameTime = parts[5];
                        console.log(`Line ${i} gameTime raw:`, JSON.stringify(gameTime));
                        console.log(`Line ${i} gameTime trimmed:`, JSON.stringify(gameTime.trim()));
                        
                        // Test date parsing
                        try {
                            const date1 = new Date(gameTime);
                            const date2 = new Date(gameTime.trim());
                            console.log(`Line ${i} Date(gameTime):`, date1);
                            console.log(`Line ${i} Date(gameTime.trim()):`, date2);
                            console.log(`Line ${i} Date valid:`, !isNaN(date1.getTime()));
                            console.log(`Line ${i} Date trimmed valid:`, !isNaN(date2.getTime()));
                        } catch (e) {
                            console.error(`Line ${i} Date parsing error:`, e);
                        }
                    }
                }
            }
            
            document.getElementById('output').innerHTML = '<p>Check console for detailed output</p>';
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            let i = 0;

            while (i < line.length) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i += 2;
                        continue;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                    i++;
                    continue;
                } else {
                    current += char;
                }
                i++;
            }
            
            result.push(current);
            // Trim whitespace and carriage returns from all fields
            return result.map(field => field.trim());
        }
    </script>
</body>
</html>
